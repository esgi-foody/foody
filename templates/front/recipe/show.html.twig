{% extends 'base.html.twig' %}

{% block title %}Recipe{% endblock %}
{% block body %}
    <section id="recipe">
        <h1>Recette {{ recipe.title }}</h1>
        <table class="table">
            <tbody>
                <tr>
                    <th>Calories</th>
                    <td>{{ recipe.calory }} kcal</td>
                </tr>
                <tr>
                    <th>Protéines</th>
                    <td>{{ recipe.protein }}g</td>
                </tr>
                <tr>
                    <th>Glucides</th>
                    <td>{{ recipe.carbohydrate }}g</td>
                </tr>
                <tr>
                    <th>Lipides</th>
                    <td>{{ recipe.fat }}g</td>
                </tr>
                <tr>
                    <th>Temps</th>
                    <td>{{ recipe.time ? recipe.time|date('H:i') : '' }}</td>
                </tr>
                <tr>
                    <td class="recipeImg">
                        {% if recipe.imageName %}
                            <img src="{{ asset('uploads/images/recipes/'~recipe.imageName)}}"></td>
                        {% else %}
                            <img src="{{ asset('build/images/defaultRecipe.png')}}"></td>
                        {% endif %}

                        {% if liked is defined and liked is not null  %}
                            <td><a href="{{ path("recipe_unlike", { "id" : recipe.id, "idLike" : liked.id, "csrf_token" : csrf_token('unlike' ~ recipe.id) }) }}"><i data-feather="heart" id="heart" stroke-width="1" fill="red"></i></a></td>
                        {% else %}
                            <td><a href="{{ path("recipe_like", { "id" : recipe.id, "csrf_token" : csrf_token('like' ~ recipe.id) }) }}"><i data-feather="heart" id="heart" stroke-width="1" stroke="red"></i></a></td>
                        {% endif %}



                            <td>
                                <a href="{{ path("recipe_repost_show", {"id" : recipe.id}) }}">{{ nbRepost ?  nbRepost}}</a>
                                {% if reposted is defined and reposted is not null  %}

                                <a href="{{ path("recipe_unrepost", { "id" : recipe.id, "idRepost" : reposted.id, "csrf_token" : csrf_token('unrepost' ~ recipe.id) }) }}"><i data-feather="repeat" id="repeat" stroke-width="2" stroke="green"></i></a>
                                {% else %}
                                <a href="{{ path("recipe_repost", { "id" : recipe.id, "csrf_token" : csrf_token('repost' ~ recipe.id) }) }}"><i data-feather="repeat" id="repeat" stroke-width="2" stroke="grey"></i></a>
                                {% endif %}
                            </td>

                    </td>
                </tr>

                <tr>
                    <th>Categories</th>
                    {% for  category in recipe.categories  %}
                        <td>{{ category.name }}</td>
                    {% endfor %}
                </tr>

            </tbody>
        </table>
        <h1>Etapes</h1>
        {% for  step in recipe.recipeSteps  %}
            <div>
                <h2>Etape n°{{ step.stepNumber }} :  {{ step.title }}</h2>
                <p>{{ step.content | raw }} </p>
            </div>

        {% endfor %}

        <h1>Ingredients</h1>
        {% for  ingredient in recipe.ingredients  %}
            <div>
                <h2>{{ ingredient.name }}</h2>
                <label>Quantités :</label> <span> {{ ingredient.quantity }} </span>
            </div>

        {% endfor %}

        {% if favorite is defined and favorite is not null  %}
            <a href="{{ path('recipe_unfavorite', {'id': recipe.id, "csrf_token" : csrf_token('unfavorite')}) }}"><i data-feather="star" stroke="orange" fill="yellow"></i></a>
        {% else %}
            <a href="{{ path('recipe_favorite', {'id': recipe.id, "csrf_token" : csrf_token('favorite')})}}"><i data-feather="star"  stroke-width="1" stroke="black"></i></a>
        {% endif %} <br>

        <div class="container-btn">
            <a href="{{ path('recipe_index') }}"><div class="btn teal lighten-1">Retour</div></a>

            {% if  app.user is same as (recipe.userRecipe) %}

                <a href="{{ path('recipe_edit', {'id': recipe.id}) }}"><div class="btn cyan lighten-1">Modifier</div></a>


                {{ include('front/recipe/_delete_form.html.twig') }}
            {% endif %}
        </div>


        {{ include('front/recipe/_comment_form.html.twig') }}
        <ul class="collection">
            {% for  comment in comments  %}
            <li class="collection-item avatar">
                <img src="{{ asset('build/images/defaultRecipe.png')}}" alt="" class="circle">
                <h5 class="title">{{ comment.commentator.pseudo }}<span class="grey-text text-lighten-1">({{ comment.createdAt|date('H:i m.d.y') }})</span></h5>
                <p>"{{ comment.data }}"</p>
                {% if  app.user is same as (comment.commentator) %}
                {{ include('front/recipe/_delete_comment_form.html.twig') }}
                {% endif %}
            </li>
            {% endfor %}
        </ul>
    </section>
{% endblock %}
